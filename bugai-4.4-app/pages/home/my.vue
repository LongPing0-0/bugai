<template>
	<view class="my">
<!-- 		<acqui-dynamic-message
			ref="dynamicMessage"
			:showTime="parseFloat(showTime) || 3"
			:hideTime="parseFloat(hideTime) || 2"
			:messagePosition="messagePosition"
			:animalType="animalType"
			:messageCusPosition="messageCusPosition"
			:messageList="messageList"
			:isFixed="isFixed"
		></acqui-dynamic-message> -->
		<image src="/static/imgs/my-bg4.png" mode="aspectFill" class="my_bg"></image>
		<view class="header_cell">
			<view class="user_info">
				<view class="flex justify-center align-center">
					<image :src="avatar" mode="aspectFill" class="user_photo"></image>
					<view>
						<view class="text-black text-bold">
							<text class="text-xl" style="font-weight: bold;">{{userInfo.nickname}}</text>
							<text class="cu-tag round bg-red" style="margin-left: 20rpx;">{{userInfo.rnameZh}}</text>
						</view>
						<view class="text-grey">
							<span>è´¦å·ï¼š</span>
							<span>{{userInfo.username}}</span>
						</view>
					</view>
				</view>
				<text class="lg text-gray cuIcon-right"></text>
			</view>
			<view class="auth_btn">
				<button class="cu-btn round bg-black" @click="out()">
					<text class="lg text-white cuIcon-exit" style="margin-right: 20rpx;"></text>
					é€€å‡ºç™»å½•
				</button>
			</view>

			<view class="vip_cell flex justify-between align-center">
				<view>
					<view class="text-xl" style="font-weight: bold;color: rgb(241, 198, 142);">
						0 æ¦‚ç‰‡
						<text class="lg cuIcon-vip" style="margin-left: 15rpx;"></text>
					</view>
					<view class="text-xs" style="margin-top: 10rpx;">è¯¥åŠŸèƒ½ç›®å‰æš‚æœªå¼€æ”¾</view>
				</view>
				<button class="cu-btn round invate_btn">æ¦‚ç‰‡</button>
			</view>
		</view>

		<view class="cell_1 flex justify-around align-center bg-white mt30"
			style="padding: 30rpx 0;border-radius: 15rpx;text-align: center;">
			<view @tap="showModal" data-target="DialogModal2">
				<view class="cell_1_icon flex justify-center align-center"><text
						class="text-gray cuIcon-refresh"></text></view>
				<view>åŠ å…¥ç­çº§</view>

			</view>
			<view @click="youxiang()">
				<view class="cell_1_icon flex justify-center align-center"><text
						class="text-gray cuIcon-settings"></text></view>
				<view>ç»‘å®šé‚®ç®±</view>
			</view>
			<view @click="xiugaimima()">
				<view class="cell_1_icon flex justify-center align-center"><text class="text-gray cuIcon-full"></text>
				</view>
				<view>ä¿®æ”¹å¯†ç </view>
			</view>
		</view>

		<view class="cell_2 flex justify-between align-center mt30">
			<view @click="tiku()">
				<view class="cell_2_icon flex justify-center align-center"><text class="text-olive cuIcon-list"></text>
				</view>
				<view>æŸ¥çœ‹é¢˜åº“</view>
			</view>
			<view @click="myDynamicDetails()">
				<view class="cell_2_icon flex justify-center align-center"><text class="text-cyan cuIcon-form"></text>
				</view>
				<view>æˆ‘çš„åŠ¨æ€</view>
			</view>
		</view>

		<view class="mt30 grid text-center col-4 bg-white"
			style="padding: 30rpx 0; border-radius: 15rpx;row-gap: 30rpx;">
			<view @click="help()">
				<view class="cell_3_icon flex justify-center align-center"><text
						class="text-cyan cuIcon-hotfill"></text></view>
				<view>å¸®åŠ©æ–‡æ¡£</view>
			</view>
			<view @click="update()">
				<view class="cell_3_icon flex justify-center align-center"><text
						class="text-cyan cuIcon-explorefill"></text></view>
				<view>æ£€æŸ¥æ›´æ–°</view>
			</view>
			
			<view @click="about()">
				<view class="cell_3_icon flex justify-center align-center"><text
						class="text-olive cuIcon-friendfamous"></text></view>
				<view>å…³äº</view>
			</view>
			
			<!-- 			<view>
				<view class="cell_3_icon flex justify-center align-center"><text class="text-cyan cuIcon-similar"></text></view>
				<view>å‘ç°å£çº¸</view>
			</view>
			<view>
				<view class="cell_3_icon flex justify-center align-center"><text class="text-cyan cuIcon-vipcard"></text></view>
				<view>ç”œèœœä¿®å‹¾</view>
			</view>
			<view>
				<view class="cell_3_icon flex justify-center align-center"><text class="text-cyan cuIcon-barcode"></text></view>
				<view>ç”œèœœä¿®å‹¾</view>
			</view>
			<view>
				<view class="cell_3_icon flex justify-center align-center"><text class="text-cyan cuIcon-upstagefill"></text></view>
				<view>ç”œèœœä¿®å‹¾</view>
			</view>
			<view>
				<view class="cell_3_icon flex justify-center align-center"><text class="text-cyan cuIcon-clothesfill"></text></view>
				<view>ç”œèœœä¿®å‹¾</view>
			</view> -->
		</view>

		<!-- 		<view class="cell_4 mt30 bg-white" style="padding:40rpx 30rpx; border-radius: 15rpx;">
			<view class="flex justify-between align-center">
				<view class="flex justify-center align-center">
					<text class="text-gray cuIcon-repair" style="margin-right: 20rpx;font-size: 40rpx;"></text>
					<text>æ›´æ–°æ—¥å¿—</text>
				</view>
				<text class="lg text-gray cuIcon-right"></text>
			</view>
			<view class="flex justify-between align-center">
				<view class="flex justify-center align-center">
					<text class="text-gray cuIcon-hot" style="margin-right: 20rpx;font-size: 40rpx;"></text>
					<text>å¸®åŠ©æ–‡æ¡£</text>
				</view>
				<text class="lg text-gray cuIcon-right"></text>
			</view>
			<view class="flex justify-between align-center">
				<view class="flex justify-center align-center">
					<text class="text-gray cuIcon-crown" style="margin-right: 20rpx;font-size: 40rpx;"></text>
					<text>ä½¿ç”¨åè®®</text>
				</view>
				<text class="lg text-gray cuIcon-right"></text>
			</view>
			<view class="flex justify-between align-center">
				<view class="flex justify-center align-center">
					<text class="text-gray cuIcon-musicfill" style="margin-right: 20rpx;font-size: 40rpx;"></text>
					<text>ä½¿ç”¨åè®®</text>
				</view>
				<text class="lg text-gray cuIcon-right"></text>
			</view>
		</view> -->

		<!-- 		<view class="cell_4 mt30 bg-white" style="padding:40rpx 30rpx; border-radius: 15rpx;">
			<view class="flex justify-between align-center">
				<view class="flex justify-center align-center">
					<text class="text-gray cuIcon-weixin" style="margin-right: 20rpx;font-size: 40rpx;"></text>
					<text>è”ç³»å®¢æœ</text>
				</view>
				<text class="lg text-gray cuIcon-right"></text>
			</view>
			<view class="flex justify-between align-center">
				<view class="flex justify-center align-center">
					<text class="text-gray cuIcon-formfill" style="margin-right: 20rpx;font-size: 40rpx;"></text>
					<text>æäº¤åé¦ˆ</text>
				</view>
				<text class="lg text-gray cuIcon-right"></text>
			</view>
			<view class="flex justify-between align-center">
				<view class="flex justify-center align-center">
					<text class="text-gray cuIcon-dianhua" style="margin-right: 20rpx;font-size: 40rpx;"></text>
					<text>æŠ€æœ¯æ”¯æŒ</text>
				</view>
				<text class="cu-tag radius sm">177****3698</text>
			</view>
			<navigator class="flex justify-between align-center" open-type="navigateBack" :delta="1">
				<view class="flex justify-center align-center">
					<text class="text-gray cuIcon-formfill" style="margin-right: 20rpx;font-size: 40rpx;"></text>
					<text>è¿”å›ä¸Šä¸€é¡µ</text>
				</view>
				<text class="lg text-gray cuIcon-right"></text>
			</navigator>
		</view> -->

		<!-- åŠ å…¥ç­çº§å¯¹è¯æ¡† -->
		<view class="cu-modal" :class="modalName=='DialogModal2'?'show':''">
			<view class="cu-dialog">
				<view class="cu-bar bg-white justify-end">
					<view class="content">åŠ å…¥æ–°ç­çº§</view>
					<view class="action" @tap="hideModal">
						<text class="cuIcon-close text-red"></text>
					</view>
				</view>

				<view class="main">
					<view class="bg-white margin-top" style="padding-bottom: 20rpx;">
						<view class="cu-bar bg-white solid-bottom">
							<view class='action'>
								<text class='cuIcon-title text-blue'></text>è¯·è¾“å…¥ç­çº§å·
							</view>
						</view>
						<view style="width: 500rpx;margin: 20rpx auto;font-size: 50rpx;font-weight: bold;">
							<verification-code-style2 borderStyle="border:1px solid gray"
								borderCheckStyle="border:1px solid blue"
								@inputVerificationChange="inputVerificationChange"></verification-code-style2>
						</view>
					</view>
				</view>
				

				<view class="cu-bar bg-white">
					<view class="action margin-0 flex-sub text-green " @tap="myClass()">
						<!-- <text class="cuIcon-squarecheck"></text>åŠ å…¥æ–°ç­çº§ -->
						<button class="cu-btn bg-blue margin-tb-sm lg">åŠ å…¥</button>
					</view>
					<view class="action margin-0 flex-sub text-green solid-left" @tap="hideModal">
					<button class="cu-btn bg-red margin-tb-sm lg">è¿”å›</button>
					</view>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
	import verificationCodeStyle2Vue from '../../components/verification-code-style2/verification-code-style2.vue'
	export default {
		data() {
			return {
				avatar: "/static/tabbar/about.png",
				//æ˜¾ç¤ºæ¡†
				showTime: 3,
				hideTime: 60,
				messagePosition: 'rightTop',
				animalType: 1,
				messageList: [
					{
						photo: '/static/1024x1024.png', //ç”¨æˆ·å¤´åƒ
						text: 'æ¬¢è¿ä½¿ç”¨è¡¥æ¦‚appï¼ğŸ˜€ğŸ˜€' //æ–‡æœ¬
					}
				],
				messageCusPosition: '',
				isFixed: false,
				//æ˜¾ç¤ºæ¡†
				modalName: null,
				classId: null,
				userInfo: {
					nickname: "æ¸¸å®¢",
					username: "æ¸¸å®¢",
					rnameZh: "æ¸¸å®¢",
					email: null
				}
			};
		},
		mounted() {
			this.getUserInfo()
		},
		methods: {

			//è·å–ç”¨æˆ·ä¿¡æ¯
			getUserInfo(){
				this.request({
					url: "/user/info",
					method: "POST"
				}).then(resp=>{
					console.log(resp)
					console.log("ç”¨æˆ·ä¿¡æ¯")
					if(resp.code == 200){
						console.log("ç”¨æˆ·ä¿¡æ¯")
						this.userInfo.nickname = ""
						this.userInfo.username = ""
						this.rnameZh = ""
						this.email = null
						let nickname = resp.data.nickname
						let rnameZh = resp.data.rnameZh
						let username = resp.data.username
						let email = resp.data.email
						let Iavatar = resp.data.avatar
						// è¿™é‡Œå…ˆæ‹¿å‡ºæ¥,åé¢å†æ”¹è¿›
						this.userInfo.nickname = nickname
						this.userInfo.username = username
						this.userInfo.rnameZh = rnameZh 
						this.userInfo.email = email

						if(Iavatar != null && Iavatar != ""){
							this.avatar = Iavatar
						}
					}
				})
			},
			/*ç»‘å®šé‚®ç®±*/
			youxiang(){
				// æŸ¥çœ‹æ˜¯å¦ç»‘å®šè¿‡é‚®ç®±
				console.log("yoxiang")
				if(this.userInfo.email != null || this.userInfo.email != ''){
					this.request({
						url: "/isRegisteredEmail",
						method: "POST",
						data: {
							email: this.userInfo.email
						}
					}).then(resp=>{
						if(resp.code == 200){
							console.log("å·²ç»æ³¨å†Œè¿‡")
							uni.showToast({
								title: "å·²ç»ç»‘å®šè¿‡é‚®ç®±ï¼",
								icon: 'none',
								duration: 1500
							})
							return;
						}
						console.log(this.userInfo.email)
						console.log("æ²¡æœ‰æ³¨å†Œè¿‡")
						uni.navigateTo({
							url: '/pages/signup/email'
						})
					})
					return;
				}
				
				uni.navigateTo({
					url: '/pages/signup/email'
				})
			},
			/*åŠ å…¥ç­çº§--begin--*/
			getVal(){
				const val= this.$refs.verificationCodeStyle2.getValue()
				uni.showModal({
					content:"è·å–åˆ°å€¼ï¼š"+val,
					showCancel:false
				})
			},
			clearVal(){
				this.$refs.verificationCodeStyle2.cleanVal()
			},
			setVal(){
				this.$refs.verificationCodeStyle2.setVerificationCode('888')
			},
			inputVerificationChange(val){
				console.log('å€¼æ”¹å˜äº†ï¼š'+val);
				this.classId = val
			},
			/*åŠ å…¥ç­çº§--end--*/
			//æäº¤ç­çº§
			myClass(){
				var that = this
				console.log("åŠ å…¥ç­çº§")
				console.log(this.classId)
				
				if(this.classId.length!=4){
					uni.showToast({
						title: 'è¾“å…¥é•¿åº¦æœ‰è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼',
						icon: 'none',  // ä¸æ˜¾ç¤ºå›¾æ ‡
						duration: 1500
					});
				}else{
					that.request({
						url: "/class/userClass",
						method: "POST",
						data: {
							name: that.classId
						}
					}).then(resp=>{
						console.log(resp)
						if(resp.code == 200){
							uni.showToast({
								title: 'åŠ å…¥ç­çº§æˆåŠŸï¼',
								icon: 'none',  // ä¸æ˜¾ç¤ºå›¾æ ‡
								duration: 1500
							});
							that.modalName = null
						}else{
							uni.showToast({
								title: 'åŠ å…¥ç­çº§å¤±è´¥ï¼Œè¯·ç¡®è®¤ç­çº§å·æ˜¯å¦æ­£ç¡®ï¼',
								icon: 'none',  // ä¸æ˜¾ç¤ºå›¾æ ‡
								duration: 1500
							});
						}
					})
				}
			},
			//éšè—å¯¹è¯æ¡†
			hideModal(e) {
				console.log("æˆ‘æ˜¯è¿”å›")
				this.modalName = null
			},
			// å±•ç¤ºå¯¹è¯æ¡†
			showModal(e) {
				console.log("åŠ å…¥ç­çº§")
				this.request({
					url: "/class/is",
					method: "GET"
				}).then(resp=>{
					if(resp.code == 200){
						this.modalName = e.currentTarget.dataset.target
					}else if(resp.code == 500){
						uni.showToast({
							icon: 'none',
							title: 'ä½ å·²ç»åŠ å…¥è¿‡ç­çº§ï¼Œæ— éœ€å†æ“ä½œï¼',
							duration: 2000
						});
					}else{
						uni.showToast({
							icon: 'none',
							title: 'å†…éƒ¨ç³»ç»Ÿé”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜æˆ–è€…è€å¸ˆï¼',
							duration: 2000
						});
					}
				})
			},
			// getUserInfo() {
			// 	var that = this
			// 	this.request({
			// 		url: "/user/info",
			// 		method: "POST"
			// 	}).then(resp => {
			// 		console.log(resp)
			// 		if (resp.code == 200) {
			// 			that.uid = resp.data.uid
			// 			that.name = resp.data.nickname
			// 		}
			// 	})
			// },
			tiku() {
				uni.navigateTo({
					url: '/pages/examination/exam_list'
				})
			},
			xiugaimima() {
				uni.navigateTo({
					url: '/pages/signup/forget'
				})
				console.log("tem")
			},
			myDynamicDetails(){
				uni.navigateTo({
					url: "/pages/myDynamic/myDynamic"
				})
				// uni.showToast({
				// 	 icon: 'none',
				// 	title: 'è¯¥åŠŸèƒ½å°†åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸Šçº¿',
				// 	duration: 2000
				// });
			},
			update() {
				// uni.showToast({
				// 	 icon: 'none',
				// 	title: 'ç›®å‰å·²ç»æ˜¯æœ€æ–°',
				// 	duration: 2000
				// });
				uni.navigateTo({
					url: '/pages/appUpdate/appUpdate'
				})
				// console.log("tem")
			},
			help() {
				// uni.showToast({
				// 	 icon: 'none',
				// 	title: 'åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­',
				// 	duration: 2000
				// });
				uni.navigateTo({
					url: "/pages/helpDocument/helpDocument"
				})
			},
			about() {
				uni.navigateTo({
					url: '/pages/teamInfo/teamInfo'
				})
				// uni.showToast({
				// 	icon: 'none',
				// 	title: 'è¯¥åŠŸèƒ½å°†åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸Šçº¿',
				// 	duration: 2000
				// });
			},
			out() {
				uni.setStorageSync("JWT", "")
				uni.navigateTo({
					url: '/pages/signup/index'
				})
			}
		},
		components:{
			verificationCodeStyle2Vue
		}
	};
</script>

<style lang="less" scoped>
	.my {
		padding: 30rpx;

		.mt30 {
			margin-top: 30rpx;
		}

		.my_bg {
			position: absolute;
			left: 0;
			top: 0;
			z-index: -1;
			width: 100%;
		}

		.header_cell {
			margin-top: 100rpx;

			.user_info {
				display: flex;
				justify-content: space-between;
				align-items: center;

				.user_photo {
					width: 120rpx;
					height: 120rpx;
					box-shadow: 0px 0px 10rpx 1px rgba(0, 0, 0, 0.1);
					border-radius: 50%;
					background-color: white;
					margin-right: 20rpx;
				}
			}

			.auth_btn {
				margin: 50rpx auto;
				text-align: center;

				&>button {
					box-shadow: 3px 3px 10rpx 1px rgba(0, 0, 0, 0.2);
					padding-left: 50rpx;
					padding-right: 50rpx;
				}
			}

			.vip_cell {
				margin-top: 40rpx;
				width: 690rpx;
				height: 150rpx;
				background-image: url('/static/imgs/vip_bg.png');
				background-size: 100% 100%;
				color: white;
				padding: 0 30rpx;

				.invate_btn {
					background-color: rgb(241, 198, 142);
					box-shadow: 3px 3px 10rpx 1px rgba(241, 198, 142, 0.5);
					width: 150rpx;
					color: rgb(99, 71, 56);
					font-weight: bold;
				}
			}
		}

		.cell_1_icon {
			width: 100rpx;
			height: 100rpx;
			background-color: #f4f2f7;
			border-radius: 50%;
			font-size: 50rpx;
			margin: 0 auto;
			margin-bottom: 15rpx;
		}

		.cell_2 {
			&>view {
				background-color: white;
				border-radius: 15rpx;
				text-align: center;
				width: 48%;
				padding: 30rpx 0;
			}

			.cell_2_icon {
				font-size: 60rpx;
				margin-bottom: 15rpx;
			}
		}

		.cell_3_icon {
			font-size: 50rpx;
			margin-bottom: 20rpx;
		}

		.cell_4 {

			&>view,
			navigator {
				padding: 20rpx 0;
			}
		}
	}
</style>